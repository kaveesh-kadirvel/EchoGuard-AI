// Language Translations
const translations = {
    en: {
        dashboard: "Dashboard",
        analytics: "Analytics",
        activityLogs: "Activity Logs",
        settings: "Settings",
        analyzeClaim: "Analyze Misinformation Claim",
        analyze: "Analyze Claim",
        clear: "Clear",
        liveFeed: "Live Feed",
        all: "All",
        twitter: "Twitter",
        whatsapp: "WhatsApp",
        news: "News",
        claimAnalysis: "Claim Analysis",
        confidence: "Confidence",
        evidenceSources: "Evidence Sources",
        emotionDistribution: "Emotion Distribution",
        bulletinGenerator: "Bulletin Generator",
        officialClarification: "OFFICIAL CLARIFICATION",
        copy: "Copy",
        download: "Download",
        share: "Share",
        claimsAnalyzed: "Claims Analyzed",
        accuracyRate: "Accuracy Rate",
        bulletinsCreated: "Bulletins Created",
        peopleReached: "People Reached",
        recentClaims: "Recent Claims Analysis",
        emotionBreakdown: "Emotion Breakdown",
        preferences: "Preferences",
        darkMode: "Dark Mode",
        emailNotifications: "Email Notifications",
        soundAlerts: "Sound Alerts",
        languagePreferences: "Language Preferences",
        dataManagement: "Data Management",
        exportData: "Export Data",
        clearCache: "Clear Cache",
        resetSettings: "Reset All Settings",
        about: "About EchoGuard AI",
        version: "Version 2.1.0",
        lastUpdated: "Last updated: November 24, 2024",
        developedBy: "Developed by EchoGuard AI Team",
        email: "Email",
        memberSince: "Member Since",
        editProfile: "Edit Profile",
        logout: "Logout",
        fullName: "Full Name",
        profileInitials: "Profile Initials",
        saveChanges: "Save Changes",
        cancel: "Cancel"
    },
    hi: {
        dashboard: "рдбреИрд╢рдмреЛрд░реНрдб",
        analytics: "рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
        activityLogs: "рдЧрддрд┐рд╡рд┐рдзрд┐ рд▓реЙрдЧ",
        settings: "рд╕реЗрдЯрд┐рдВрдЧреНрд╕",
        analyzeClaim: "рдЧрд▓рдд рд╕реВрдЪрдирд╛ рджрд╛рд╡реЗ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ",
        analyze: "рджрд╛рд╡реЗ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ",
        clear: "рд╕рд╛рдлрд╝ рдХрд░реЗрдВ",
        liveFeed: "рд▓рд╛рдЗрд╡ рдлреАрдб",
        all: "рд╕рднреА",
        twitter: "рдЯреНрд╡рд┐рдЯрд░",
        whatsapp: "рд╡реНрд╣рд╛рдЯреНрд╕рдПрдк",
        news: "рд╕рдорд╛рдЪрд╛рд░",
        claimAnalysis: "рджрд╛рд╡рд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
        confidence: "рд╡рд┐рд╢реНрд╡рд╛рд╕",
        evidenceSources: "рд╕рд╛рдХреНрд╖реНрдп рд╕реНрд░реЛрдд",
        emotionDistribution: "рднрд╛рд╡рдирд╛ рд╡рд┐рддрд░рдг",
        bulletinGenerator: "рдмреБрд▓реЗрдЯрд┐рди рдЬрдирд░реЗрдЯрд░",
        officialClarification: "рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг",
        copy: "рдХреЙрдкреА рдХрд░реЗрдВ",
        download: "рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ",
        share: "рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ",
        claimsAnalyzed: "рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рджрд╛рд╡реЗ",
        accuracyRate: "рд╕рдЯреАрдХрддрд╛ рджрд░",
        bulletinsCreated: "рдмрдирд╛рдП рдЧрдП рдмреБрд▓реЗрдЯрд┐рди",
        peopleReached: "рд▓реЛрдЧреЛрдВ рддрдХ рдкрд╣реБрдВрдЪреЗ",
        recentClaims: "рд╣рд╛рд▓ рдХреЗ рджрд╛рд╡реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
        emotionBreakdown: "рднрд╛рд╡рдирд╛ рд╡рд┐рднрд╛рдЬрди",
        preferences: "рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ",
        darkMode: "рдбрд╛рд░реНрдХ рдореЛрдб",
        emailNotifications: "рдИрдореЗрд▓ рд╕реВрдЪрдирд╛рдПрдВ",
        soundAlerts: "рдзреНрд╡рдирд┐ рдЕрд▓рд░реНрдЯ",
        languagePreferences: "рднрд╛рд╖рд╛ рдкреНрд░рд╛рдердорд┐рдХрддрд╛рдПрдВ",
        dataManagement: "рдбреЗрдЯрд╛ рдкреНрд░рдмрдВрдзрди",
        exportData: "рдбреЗрдЯрд╛ рдирд┐рд░реНрдпрд╛рдд рдХрд░реЗрдВ",
        clearCache: "рдХреИрд╢ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ",
        resetSettings: "рд╕рднреА рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рд░реАрд╕реЗрдЯ рдХрд░реЗрдВ",
        about: "EchoGuard AI рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ",
        version: "рд╕рдВрд╕реНрдХрд░рдг 2.1.0",
        lastUpdated: "рдЕрдВрддрд┐рдо рдЕрджреНрдпрддрди: 24 рдирд╡рдВрдмрд░ 2024",
        developedBy: "EchoGuard AI рдЯреАрдо рджреНрд╡рд╛рд░рд╛ рд╡рд┐рдХрд╕рд┐рдд",
        email: "рдИрдореЗрд▓",
        memberSince: "рд╕рджрд╕реНрдпрддрд╛ рдкреНрд░рд╛рд░рдВрдн",
        editProfile: "рдкреНрд░реЛрдлрд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ",
        logout: "рд▓реЙрдЧрдЖрдЙрдЯ",
        fullName: "рдкреВрд░рд╛ рдирд╛рдо",
        profileInitials: "рдкреНрд░реЛрдлрд╛рдЗрд▓ рдЖрджреНрдпрд╛рдХреНрд╖рд░",
        saveChanges: "рдкрд░рд┐рд╡рд░реНрддрди рд╕рд╣реЗрдЬреЗрдВ",
        cancel: "рд░рджреНрдж рдХрд░реЗрдВ"
    },
    mr: {
        dashboard: "рдбреЕрд╢рдмреЛрд░реНрдб",
        analytics: "рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
        activityLogs: "рдХреНрд░рд┐рдпрд╛рдХрд▓рд╛рдк рд▓реЙрдЧ",
        settings: "рд╕реЗрдЯрд┐рдВрдЧреНрдЬ",
        analyzeClaim: "рдЪреБрдХреАрдЪреА рдорд╛рд╣рд┐рддреА рджрд╛рд╡реНрдпрд╛рдЪреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рд╛",
        analyze: "рджрд╛рд╡реНрдпрд╛рдЪреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рд╛",
        clear: "рд╕рд╛рдл рдХрд░рд╛",
        liveFeed: "рд▓рд╛рдЗрд╡ рдлреАрдб",
        all: "рд╕рд░реНрд╡",
        twitter: "рдЯреНрд╡рд┐рдЯрд░",
        whatsapp: "рд╡реНрд╣рд╛рдЯреНрд╕рдЕреЕрдк",
        news: "рдмрд╛рддрдореНрдпрд╛",
        claimAnalysis: "рджрд╛рд╡рд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
        confidence: "рдЖрддреНрдорд╡рд┐рд╢реНрд╡рд╛рд╕",
        evidenceSources: "рдкреБрд░рд╛рд╡рд╛ рд╕реНрд░реЛрдд",
        emotionDistribution: "рднрд╛рд╡рдирд╛ рд╡рд┐рддрд░рдг",
        bulletinGenerator: "рдмреБрд▓реЗрдЯрд┐рди рдЬрдирд░реЗрдЯрд░",
        officialClarification: "рдЕрдзрд┐рдХреГрдд рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг",
        copy: "рдХреЙрдкреА рдХрд░рд╛",
        download: "рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рд╛",
        share: "рд╢реЗрдЕрд░ рдХрд░рд╛",
        claimsAnalyzed: "рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рджрд╛рд╡реЗ",
        accuracyRate: "рдЕрдЪреВрдХрддрд╛ рджрд░",
        bulletinsCreated: "рддрдпрд╛рд░ рдХреЗрд▓реЗрд▓реЗ рдмреБрд▓реЗрдЯрд┐рди",
        peopleReached: "рд▓реЛрдХрд╛рдВрдкрд░реНрдпрдВрдд рдкреЛрд╣реЛрдЪрд▓реЗ",
        recentClaims: "рдЕрд▓реАрдХрдбреАрд▓ рджрд╛рд╡реЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг",
        emotionBreakdown: "рднрд╛рд╡рдирд╛ рд╡рд┐рднрд╛рдЬрди",
        preferences: "рдкреНрд░рд╛рдзрд╛рдиреНрдпреЗ",
        darkMode: "рдбрд╛рд░реНрдХ рдореЛрдб",
        emailNotifications: "рдИрдореЗрд▓ рд╕реВрдЪрдирд╛",
        soundAlerts: "рдзреНрд╡рдиреА рдЕрд▓рд░реНрдЯ",
        languagePreferences: "рднрд╛рд╖рд╛ рдкреНрд░рд╛рдзрд╛рдиреНрдпреЗ",
        dataManagement: "рдбреЗрдЯрд╛ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди",
        exportData: "рдбреЗрдЯрд╛ рдирд┐рд░реНрдпрд╛рдд рдХрд░рд╛",
        clearCache: "рдХреЕрд╢реЗ рд╕рд╛рдл рдХрд░рд╛",
        resetSettings: "рд╕рд░реНрд╡ рд╕реЗрдЯрд┐рдВрдЧреНрдЬ рд░реАрд╕реЗрдЯ рдХрд░рд╛",
        about: "EchoGuard AI рдмрджреНрджрд▓",
        version: "рдЖрд╡реГрддреНрддреА 2.1.0",
        lastUpdated: "рд╢реЗрд╡рдЯрдЪреЗ рдЕрджреНрдпрддрди: 24 рдиреЛрд╡реНрд╣реЗрдВрдмрд░ 2024",
        developedBy: "EchoGuard AI рд╕рдВрдШрд╛рдиреЗ рд╡рд┐рдХрд╕рд┐рдд",
        email: "рдИрдореЗрд▓",
        memberSince: "рд╕рджрд╕реНрдпрддреНрд╡ рд╕реБрд░реВ",
        editProfile: "рдкреНрд░реЛрдлрд╛рдЗрд▓ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рд╛",
        logout: "рд▓реЙрдЧрдЖрдЙрдЯ",
        fullName: "рдкреВрд░реНрдг рдирд╛рд╡",
        profileInitials: "рдкреНрд░реЛрдлрд╛рдЗрд▓ рдЖрджреНрдпрд╛рдХреНрд╖рд░реЗ",
        saveChanges: "рдмрджрд▓ рдЬрддрди рдХрд░рд╛",
        cancel: "рд░рджреНрдж рдХрд░рд╛"
    },
    ta: {
        dashboard: "роЯро╛ро╖рпНрокрпЛро░рпНроЯрпБ",
        analytics: "рокроХрпБрокрпНрокро╛ропрпНро╡рпБ",
        activityLogs: "роЪрпЖропро▓рпНрокро╛роЯрпБ рокродро┐ро╡рпБроХро│рпН",
        settings: "роЕроорпИрокрпНрокрпБроХро│рпН",
        analyzeClaim: "родро╡ро▒ро╛рой родроХро╡ро▓рпН роХрпВро▒рпНро▒рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН",
        analyze: "роХрпВро▒рпНро▒рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН",
        clear: "родрпБроЯрпИроХрпНроХ",
        liveFeed: "роирпЗро░роЯро┐ роКроЯрпНроЯроорпН",
        all: "роЕройрпИродрпНродрпБроорпН",
        twitter: "роЯрпНро╡ро┐роЯрпНроЯро░рпН",
        whatsapp: "ро╡ро╛роЯрпНро╕рпНроЕрокрпН",
        news: "роЪрпЖропрпНродро┐роХро│рпН",
        claimAnalysis: "роХрпВро▒рпНро▒рпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ",
        confidence: "роироорпНрокро┐роХрпНроХрпИ",
        evidenceSources: "роЪро╛ройрпНро▒рпБ роЖродро╛ро░роЩрпНроХро│рпН",
        emotionDistribution: "роЙрогро░рпНроЪрпНроЪро┐ ро╡ро┐роиро┐ропрпЛроХроорпН",
        bulletinGenerator: "рокрпБро▓рпНро▓роЯрпНроЯро┐ройрпН роЬрпЖройро░рпЗроЯрпНроЯро░рпН",
        officialClarification: "роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ родрпЖро│ро┐ро╡рпБрокроЯрпБродрпНродро▓рпН",
        copy: "роироХро▓рпЖроЯрпБ",
        download: "рокродро┐ро╡ро┐ро▒роХрпНроХрпБ",
        share: "рокроХро┐ро░рпН",
        claimsAnalyzed: "рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯ роХрпВро▒рпНро▒рпБроХро│рпН",
        accuracyRate: "родрпБро▓рпНро▓ро┐роп ро╡ро┐роХро┐родроорпН",
        bulletinsCreated: "роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯ рокрпБро▓рпНро▓роЯрпНроЯро┐ройрпНроХро│рпН",
        peopleReached: "роороХрпНроХро│рпН роЕроЯрпИроирпНродройро░рпН",
        recentClaims: "роЪроорпАрокродрпНродро┐роп роХрпВро▒рпНро▒рпБроХро│рпН рокроХрпБрокрпНрокро╛ропрпНро╡рпБ",
        emotionBreakdown: "роЙрогро░рпНроЪрпНроЪро┐ рокро┐ро░ро┐ро╡рпБ",
        preferences: "ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН",
        darkMode: "роЗро░рпБрогрпНроЯ роорпБро▒рпИ",
        emailNotifications: "рооро┐ройрпНройроЮрпНроЪро▓рпН роЕро▒ро┐ро╡ро┐рокрпНрокрпБроХро│рпН",
        soundAlerts: "роТро▓ро┐ роОроЪрпНроЪро░ро┐роХрпНроХрпИроХро│рпН",
        languagePreferences: "роорпКро┤ро┐ ро╡ро┐ро░рпБрокрпНрокроЩрпНроХро│рпН",
        dataManagement: "родро░ро╡рпБ роорпЗро▓ро╛рогрпНроорпИ",
        exportData: "родро░ро╡рпИ роПро▒рпНро▒рпБроородро┐ роЪрпЖропрпНропрпБроЩрпНроХро│рпН",
        clearCache: "роХрпЗроЪрпЗ ро╡рпЖро▒рпНро▒рпБ",
        resetSettings: "роЕройрпИродрпНродрпБ роЕроорпИрокрпНрокрпБроХро│рпИропрпБроорпН роорпАроЯрпНроЯроорпИроХрпНроХро╡рпБроорпН",
        about: "EchoGuard AI рокро▒рпНро▒ро┐",
        version: "рокродро┐рокрпНрокрпБ 2.1.0",
        lastUpdated: "роХроЯрпИроЪро┐ропро╛роХ рокрпБродрпБрокрпНрокро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ: роиро╡роорпНрокро░рпН 24, 2024",
        developedBy: "EchoGuard AI роХрпБро┤рпБро╡ро╛ро▓рпН роЙро░рпБро╡ро╛роХрпНроХрокрпНрокроЯрпНроЯродрпБ",
        email: "рооро┐ройрпНройроЮрпНроЪро▓рпН",
        memberSince: "роЙро▒рпБрокрпНрокро┐ройро░рпН родрпКроЯроХрпНроХроорпН",
        editProfile: "роЪрпБропро╡ро┐ро╡ро░родрпНродрпИродрпН родро┐ро░рпБродрпНродрпБ",
        logout: "ро╡рпЖро│ро┐ропрпЗро▒рпБ",
        fullName: "роорпБро┤рпБ рокрпЖропро░рпН",
        profileInitials: "роЪрпБропро╡ро┐ро╡ро░ роорпБродро▓рпЖро┤рпБродрпНродрпБроХро│рпН",
        saveChanges: "рооро╛ро▒рпНро▒роЩрпНроХро│рпИ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН",
        cancel: "ро░родрпНродрпБ роЪрпЖропрпН"
    }
};

// Current language
let currentLanguage = 'en';

// User Data Management
let currentUser = {
    name: "Aarya Pandaram",
    email: "aarya.pandaram@gmail.com",
    role: "Verified Analyst",
    initials: "AP",
    joinDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
};

// Analytics Data
let analyticsData = {
    totalClaims: 0,
    accuracyRate: 0,
    bulletinsCreated: 0,
    peopleReached: 0,
    recentClaims: [],
    emotionBreakdown: {
        fear: 0,
        anger: 0,
        confusion: 0,
        calm: 0
    }
};

// Activity Logs
let activityLogs = [];

// DOM Elements
const loginPage = document.getElementById('loginPage');
const mainApp = document.getElementById('mainApp');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const themeToggle = document.getElementById('themeToggle');
const darkModeToggle = document.getElementById('darkModeToggle');
const analyzeBtn = document.getElementById('analyzeBtn');
const clearClaimBtn = document.getElementById('clearClaimBtn');
const uploadArea = document.getElementById('uploadArea');
const fileInput = document.getElementById('fileInput');
const searchInput = document.getElementById('searchInput');
const profileToggle = document.getElementById('profileToggle');
const profileArrow = document.getElementById('profileArrow');
const mobileProfileToggle = document.getElementById('mobileProfileToggle');
const profileModal = document.getElementById('profileModal');
const editProfileModal = document.getElementById('editProfileModal');
const notificationBtn = document.getElementById('notificationBtn');
const notificationPanel = document.getElementById('notificationPanel');
const toast = document.getElementById('toast');
const toastMessage = document.getElementById('toastMessage');

// Profile Elements
const profileName = document.getElementById('profileName');
const profileInitials = document.getElementById('profileInitials');
const profileRole = document.getElementById('profileRole');
const mobileProfileInitials = document.getElementById('mobileProfileInitials');
const modalProfileName = document.getElementById('modalProfileName');
const modalProfileEmail = document.getElementById('modalProfileEmail');
const modalProfileRole = document.getElementById('modalProfileRole');
const modalProfileJoin = document.getElementById('modalProfileJoin');
const modalProfileInitials = document.getElementById('modalProfileInitials');

// Edit Profile Elements
const editProfileName = document.getElementById('editProfileName');
const editProfileEmail = document.getElementById('editProfileEmail');
const editProfileInitials = document.getElementById('editProfileInitials');
const editProfileBtn = document.getElementById('editProfileBtn');
const saveProfileBtn = document.getElementById('saveProfileBtn');
const cancelEditProfile = document.getElementById('cancelEditProfile');

// Dashboard Elements
const claimInput = document.getElementById('claimInput');
const currentClaim = document.getElementById('currentClaim');
const verdictSection = document.getElementById('verdictSection');
const evidenceSection = document.getElementById('evidenceSection');
const emotionSection = document.getElementById('emotionSection');
const evidenceCards = document.getElementById('evidenceCards');
const emotionGrid = document.getElementById('emotionGrid');
const bulletinContent = document.getElementById('bulletinContent');
const feedItems = document.getElementById('feedItems');

// Analytics Elements
const totalClaims = document.getElementById('totalClaims');
const accuracyRate = document.getElementById('accuracyRate');
const bulletinsCreated = document.getElementById('bulletinsCreated');
const peopleReached = document.getElementById('peopleReached');
const recentClaims = document.getElementById('recentClaims');
const emotionBreakdown = document.getElementById('emotionBreakdown');

// Activity Logs Elements
const activityTimeline = document.getElementById('activityTimeline');

// Settings Elements
const emailNotifications = document.getElementById('emailNotifications');
const soundAlerts = document.getElementById('soundAlerts');
const langEnglish = document.getElementById('langEnglish');
const langHindi = document.getElementById('langHindi');
const langMarathi = document.getElementById('langMarathi');
const langTamil = document.getElementById('langTamil');
const exportData = document.getElementById('exportData');
const clearCache = document.getElementById('clearCache');
const resetSettings = document.getElementById('resetSettings');

// Bulletin Elements
const copyBulletin = document.getElementById('copyBulletin');
const downloadBulletin = document.getElementById('downloadBulletin');
const shareBulletin = document.getElementById('shareBulletin');

// Navigation
const navItems = document.querySelectorAll('.nav-item');
const pages = document.querySelectorAll('.page');

// Language radio buttons
const languageRadios = document.querySelectorAll('input[name="language"]');

// Bulletin language tabs
const bulletinTabs = document.querySelectorAll('.tab-btn[data-lang]');

// Initialize the application
function initApp() {
    updateUserProfile();
    updateAnalytics();
    generateFeedItems();
    updateActivityLogs();
    setupEventListeners();
    applyLanguage(currentLanguage);
}

// Update user profile
function updateUserProfile() {
    profileName.textContent = currentUser.name;
    profileRole.textContent = currentUser.role;
    profileInitials.textContent = currentUser.initials;
    mobileProfileInitials.textContent = currentUser.initials;
    modalProfileName.textContent = currentUser.name;
    modalProfileEmail.textContent = currentUser.email;
    modalProfileRole.textContent = currentUser.role;
    modalProfileJoin.textContent = currentUser.joinDate;
    modalProfileInitials.textContent = currentUser.initials;
    
    editProfileName.value = currentUser.name;
    editProfileEmail.value = currentUser.email;
    editProfileInitials.value = currentUser.initials;
}

// Update analytics
function updateAnalytics() {
    totalClaims.textContent = analyticsData.totalClaims;
    accuracyRate.textContent = `${analyticsData.accuracyRate}%`;
    bulletinsCreated.textContent = analyticsData.bulletinsCreated;
    peopleReached.textContent = analyticsData.peopleReached.toLocaleString();
    
    // Update recent claims
    recentClaims.innerHTML = '';
    if (analyticsData.recentClaims.length === 0) {
        recentClaims.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-4">No claims analyzed yet</p>';
    } else {
        analyticsData.recentClaims.forEach(claim => {
            const claimElement = document.createElement('div');
            claimElement.className = 'p-3 border-b border-gray-200 dark:border-gray-600 last:border-b-0';
            claimElement.innerHTML = `
                <div class="flex justify-between items-start mb-1">
                    <span class="text-sm dark:text-gray-300 flex-1 mr-2">${claim.text}</span>
                    <span class="text-xs px-2 py-1 rounded ${claim.verdict === 'FALSE' ? 'bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200' : 'bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200'}">${claim.verdict}</span>
                </div>
                <div class="text-xs text-gray-500 dark:text-gray-400">${claim.time}</div>
            `;
            recentClaims.appendChild(claimElement);
        });
    }
    
    // Update emotion breakdown
    emotionBreakdown.innerHTML = '';
    for (const [emotion, percentage] of Object.entries(analyticsData.emotionBreakdown)) {
        const emotionElement = document.createElement('div');
        emotionElement.className = 'text-center p-3 bg-gray-50 dark:bg-gray-700 rounded-xl';
        emotionElement.innerHTML = `
            <div class="text-2xl mb-2">${getEmoji(emotion)}</div>
            <div class="text-sm font-medium dark:text-white capitalize">${emotion}</div>
            <div class="text-xs text-gray-500 dark:text-gray-400">${percentage}%</div>
        `;
        emotionBreakdown.appendChild(emotionElement);
    }
}

// Generate feed items
function generateFeedItems() {
    const sampleClaims = [
        {
            source: 'Twitter',
            text: 'Breaking: Cyclone alert issued for Mumbai coastal areas. Evacuations underway.',
            time: '2 min ago',
            emotion: 'fear',
            virality: 85
        },
        {
            source: 'WhatsApp',
            text: 'Fake news about Mumbai local trains shutdown tomorrow. Official sources confirm normal operations.',
            time: '15 min ago',
            emotion: 'anger',
            virality: 60
        },
        {
            source: 'News Portal',
            text: 'Rumors about NEET exam postponement are false. NTA confirms dates remain unchanged.',
            time: '1 hour ago',
            emotion: 'confusion',
            virality: 30
        }
    ];
    
    feedItems.innerHTML = '';
    sampleClaims.forEach(claim => {
        const feedCard = document.createElement('div');
        feedCard.className = 'feed-card';
        feedCard.innerHTML = `
            <div class="flex items-center mb-3">
                <div class="w-8 h-8 ${getSourceColor(claim.source)} rounded-full flex items-center justify-center text-white text-xs mr-3">
                    <i class="${getSourceIcon(claim.source)}"></i>
                </div>
                <span class="font-medium text-sm dark:text-white">${claim.source}</span>
                <span class="ml-auto text-xs text-gray-500 dark:text-gray-400">${claim.time}</span>
            </div>
            <p class="text-sm mb-3 dark:text-gray-300">${claim.text}</p>
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <span class="text-lg mr-1">${getEmoji(claim.emotion)}</span>
                    <span class="text-xs dark:text-gray-300 capitalize">${claim.emotion}</span>
                </div>
                <div class="w-24 bg-gray-200 rounded-full h-2 dark:bg-gray-600">
                    <div class="${getViralityColor(claim.virality)} h-2 rounded-full" style="width: ${claim.virality}%"></div>
                </div>
                <span class="text-xs font-medium dark:text-gray-300">${claim.virality}%</span>
            </div>
        `;
        
        feedCard.addEventListener('click', () => {
            currentClaim.textContent = `"${claim.text}"`;
            showToast('Claim loaded for analysis');
        });
        
        feedItems.appendChild(feedCard);
    });
}

// Update activity logs
function updateActivityLogs() {
    activityTimeline.innerHTML = '';
    
    if (activityLogs.length === 0) {
        activityTimeline.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center py-8">No activity yet. Analyze a claim to see activity logs.</p>';
        return;
    }
    
    activityLogs.forEach(log => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `
            <div class="timeline-content">
                <div class="flex items-center mb-2">
                    <div class="font-medium dark:text-white">${log.title}</div>
                    <div class="ml-auto text-sm text-gray-500 dark:text-gray-400">${log.time}</div>
                </div>
                <p class="text-sm dark:text-gray-300">${log.description}</p>
            </div>
        `;
        activityTimeline.appendChild(timelineItem);
    });
}

// Apply language to the UI
function applyLanguage(lang) {
    currentLanguage = lang;
    
    // Update all elements with data-translate attribute
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    // Update bulletin content based on language
    updateBulletinContent(lang);
}

// Update bulletin content based on language
function updateBulletinContent(lang) {
    const claimText = currentClaim.textContent.replace(/"/g, '');
    
    if (claimText === 'Enter a claim to analyze it for misinformation' || claimText === '') {
        if (lang === 'en') {
            bulletinContent.textContent = 'Enter a claim and analyze it to generate a clarification bulletin.';
        } else if (lang === 'hi') {
            bulletinContent.textContent = 'рдПрдХ рджрд╛рд╡рд╛ рджрд░реНрдЬ рдХрд░реЗрдВ рдФрд░ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдмреБрд▓реЗрдЯрд┐рди рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВред';
        } else if (lang === 'mr') {
            bulletinContent.textContent = 'рдПрдХ рджрд╛рд╡рд╛ рдкреНрд░рд╡рд┐рд╖реНрдЯ рдХрд░рд╛ рдЖрдгрд┐ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдмреБрд▓реЗрдЯрд┐рди рдирд┐рд░реНрдорд╛рдг рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рддреНрдпрд╛рдЪреЗ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рд╛.';
        } else if (lang === 'ta') {
            bulletinContent.textContent = 'роТро░рпБ роХрпВро▒рпНро▒рпИ роЙро│рпНро│ро┐роЯрпНроЯрпБ, родрпЖро│ро┐ро╡рпБрокроЯрпБродрпНродро▓рпН рокрпБро▓рпНро▓роЯрпНроЯро┐ройрпИ роЙро░рпБро╡ро╛роХрпНроХ роЕродрпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпНропрпБроЩрпНроХро│рпН.';
        }
        return;
    }
    
    const bulletins = {
        en: `Rumors about "${claimText}" are FALSE. Official sources confirm this information is inaccurate. Please rely only on verified sources for accurate information.`,
        hi: `"${claimText}" рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдлрд╡рд╛рд╣реЗрдВ рдЧрд▓рдд рд╣реИрдВред рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрддреЛрдВ рдиреЗ рдкреБрд╖реНрдЯрд┐ рдХреА рд╣реИ рдХрд┐ рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рдЧрд▓рдд рд╣реИред рдХреГрдкрдпрд╛ рд╕рдЯреАрдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рд╕рддреНрдпрд╛рдкрд┐рдд рд╕реНрд░реЛрддреЛрдВ рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░реЗрдВред`,
        mr: `"${claimText}" рдмрджреНрджрд▓рдЪреНрдпрд╛ рдЕрдлрд╡рд╛ рдЦреЛрдЯреНрдпрд╛ рдЖрд╣реЗрдд. рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрддрд╛рдВрдиреА рдпрд╛ рдорд╛рд╣рд┐рддреАрдЪреА рдкреБрд╖реНрдЯреА рдХреЗрд▓реА рдЖрд╣реЗ рдХреА рд╣реА рдорд╛рд╣рд┐рддреА рдЪреБрдХреАрдЪреА рдЖрд╣реЗ. рдХреГрдкрдпрд╛ рдЕрдЪреВрдХ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА рдХреЗрд╡рд│ рд╕рддреНрдпрд╛рдкрд┐рдд рд╕реНрд░реЛрддрд╛рдВрд╡рд░ рдЕрд╡рд▓рдВрдмреВрди рд░рд╣рд╛.`,
        ta: `"${claimText}" рокро▒рпНро▒ро┐роп ро╡родроирпНродро┐роХро│рпН родро╡ро▒ро╛ройро╡рпИ. роЗроирпНрод родроХро╡ро▓рпН родрпБро▓рпНро▓ро┐ропрооро▒рпНро▒родрпБ роОрой роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░роЩрпНроХро│рпН роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродро┐ропрпБро│рпНро│рой. родрпБро▓рпНро▓ро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ роЪро░ро┐рокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯ роЖродро╛ро░роЩрпНроХро│рпИ роороЯрпНроЯрпБроорпЗ роироорпНрокро╡рпБроорпН.`
    };
    
    bulletinContent.textContent = bulletins[lang] || bulletins.en;
}

// Helper functions
function getSourceColor(source) {
    switch(source) {
        case 'Twitter': return 'bg-blue-500';
        case 'WhatsApp': return 'bg-green-500';
        case 'News Portal': return 'bg-orange-500';
        default: return 'bg-gray-500';
    }
}

function getSourceIcon(source) {
    switch(source) {
        case 'Twitter': return 'fab fa-twitter';
        case 'WhatsApp': return 'fab fa-whatsapp';
        case 'News Portal': return 'far fa-newspaper';
        default: return 'fas fa-globe';
    }
}

function getViralityColor(virality) {
    if (virality >= 70) return 'bg-red-500';
    if (virality >= 40) return 'bg-orange-500';
    return 'bg-blue-500';
}

function getEmoji(emotion) {
    switch(emotion) {
        case 'fear': return 'ЁЯШи';
        case 'anger': return 'ЁЯШб';
        case 'confusion': return 'ЁЯШХ';
        case 'calm': return 'ЁЯЩВ';
        default: return 'ЁЯШР';
    }
}

// Setup event listeners
function setupEventListeners() {
    // Show Signup Modal
    const showSignupBtn = document.getElementById('showSignupBtn');
    const signupModal = document.getElementById('signupModal');
    const cancelSignup = document.getElementById('cancelSignup');
    const signupBtn = document.getElementById('signupBtn');
    
    showSignupBtn.addEventListener('click', () => {
        signupModal.classList.add('active');
    });
    
    cancelSignup.addEventListener('click', () => {
        signupModal.classList.remove('active');
    });
    
    // Signup Functionality
    signupBtn.addEventListener('click', handleSignup);
    
    // Close signup modal when clicking outside
    signupModal.addEventListener('click', (e) => {
        if (e.target === signupModal) {
            signupModal.classList.remove('active');
        }
    });

    // Login Functionality
    loginBtn.addEventListener('click', handleLogin);
    
    // // Google Sign-in Functionality
    // const googleSigninBtn = document.querySelector('button[class*="bg-white"][class*="border-gray-200"]');
    // googleSigninBtn.addEventListener('click', handleGoogleSignin);

    // ... rest of your existing event listeners remain the same
    // (logoutBtn, themeToggle, navItems, etc.)

    // Logout Functionality
    logoutBtn.addEventListener('click', () => {
        mainApp.style.display = 'none';
        loginPage.style.display = 'flex';
        profileModal.classList.remove('active');
        
        // Clear login form
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        
        showToast('You have been logged out.');
    });
    
    // Theme Toggle
    themeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        
        if (document.documentElement.classList.contains('dark')) {
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
            darkModeToggle.checked = true;
        } else {
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
            darkModeToggle.checked = false;
        }
    });
    
    // Settings Dark Mode Toggle
    darkModeToggle.addEventListener('change', () => {
        document.documentElement.classList.toggle('dark');
        
        if (document.documentElement.classList.contains('dark')) {
            themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
        } else {
            themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
        }
    });
    
    // Page Navigation
    navItems.forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            
            // Remove active class from all items
            navItems.forEach(navItem => navItem.classList.remove('active'));
            // Add active class to clicked item
            item.classList.add('active');
            
            // Hide all pages
            pages.forEach(page => page.classList.remove('active'));
            // Show selected page
            const pageId = item.getAttribute('data-page') + 'Page';
            document.getElementById(pageId).classList.add('active');
        });
    });
    
    // File Upload
    uploadArea.addEventListener('click', () => {
        fileInput.click();
    });
    
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            const fileName = e.target.files[0].name;
            showToast(`File "${fileName}" uploaded successfully.`);
        }
    });
    
    // Clear Claim Button
    clearClaimBtn.addEventListener('click', () => {
        claimInput.value = '';
        currentClaim.textContent = '"Enter a claim to analyze it for misinformation"';
        verdictSection.style.display = 'none';
        evidenceSection.style.display = 'none';
        emotionSection.style.display = 'none';
        updateBulletinContent(currentLanguage);
        showToast('Claim cleared');
    });
    
    // Analyze Button
    analyzeBtn.addEventListener('click', () => {
        const claimText = claimInput.value;

        if (!claimText.trim()) {
            showToast('Please enter a claim to analyze.');
            return;
        }

        showToast('Analyzing claim for misinformation...');

        // Try to call backend analysis endpoint; if it fails, fall back to local simulation
        fetch('http://localhost:8000/analysis/process_claim', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ text: claimText })
        })
        .then(res => res.json())
        .then(data => {
            // Update analytics data
            analyticsData.totalClaims++;
            const conf = data.confidence || 87;
            analyticsData.accuracyRate = Math.min(100, Math.floor((analyticsData.accuracyRate * (analyticsData.totalClaims - 1) + conf) / analyticsData.totalClaims));
            analyticsData.bulletinsCreated++;
            analyticsData.peopleReached += Math.floor(Math.random() * 1000) + 100;

            // Add to recent claims
            analyticsData.recentClaims.unshift({
                text: claimText.length > 50 ? claimText.substring(0, 50) + '...' : claimText,
                verdict: (data.status || 'FALSE'),
                confidence: conf,
                time: 'Just now'
            });

            if (analyticsData.recentClaims.length > 5) analyticsData.recentClaims.pop();

            // If backend returned structured sentiment or emotion breakdown, use it. Otherwise, generate a randomized breakdown.
            if (data.sentiment && typeof data.sentiment === 'object') {
                // Expecting fields like fear/anger/confusion/calm in percentages or scores
                analyticsData.emotionBreakdown = {
                    fear: Math.round((data.sentiment.fear || 0) * 100) || 0,
                    anger: Math.round((data.sentiment.anger || 0) * 100) || 0,
                    confusion: Math.round((data.sentiment.confusion || 0) * 100) || 0,
                    calm: Math.round((data.sentiment.calm || 0) * 100) || 0
                };
            } else {
                analyticsData.emotionBreakdown = {
                    fear: Math.floor(Math.random() * 40) + 20,
                    anger: Math.floor(Math.random() * 30) + 10,
                    confusion: Math.floor(Math.random() * 25) + 5,
                    calm: Math.floor(Math.random() * 20) + 5
                };
            }

            // Normalize to 100%
            const total = Object.values(analyticsData.emotionBreakdown).reduce((a, b) => a + b, 0) || 1;
            for (const emotion in analyticsData.emotionBreakdown) {
                analyticsData.emotionBreakdown[emotion] = Math.round((analyticsData.emotionBreakdown[emotion] / total) * 100);
            }

            // Add activity log
            activityLogs.unshift({
                title: 'Claim Analyzed',
                description: `Analyzed claim: "${claimText}" - Verdict: ${data.status || 'FALSE'} with ${conf}% confidence`,
                time: 'Just now'
            });

            // Update UI
            currentClaim.textContent = `"${claimText}"`;
            verdictSection.style.display = 'flex';
            evidenceSection.style.display = 'block';
            emotionSection.style.display = 'block';

            // Update evidence cards from backend evidence array (if present)
            if (Array.isArray(data.evidence) && data.evidence.length > 0) {
                evidenceCards.innerHTML = data.evidence.map(ev => {
                    const title = (typeof ev === 'string') ? ev : (ev.source || ev.title || 'Source');
                    const subtitle = (typeof ev === 'string') ? '' : (ev.note || ev.summary || 'View source');
                    return `\n                        <div class="evidence-card">\n                            <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white mr-4">\n                                <i class="fas fa-link"></i>\n                            </div>\n                            <div>\n                                <div class="font-medium text-sm dark:text-white">${title}</div>\n                                <div class="text-blue-600 text-xs dark:text-blue-400">${subtitle}</div>\n                            </div>\n                        </div>`;
                }).join('');
            } else {
                evidenceCards.innerHTML = `
                    <div class="evidence-card">
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white mr-4">
                            <i class="fas fa-satellite"></i>
                        </div>
                        <div>
                            <div class="font-medium text-sm dark:text-white">IMD</div>
                            <div class="text-blue-600 text-xs dark:text-blue-400">View official statement</div>
                        </div>
                    </div>
                `;
            }

            // Update emotion grid
            emotionGrid.innerHTML = `
                <div class="heatmap-cell heatmap-fear">ЁЯШи ${analyticsData.emotionBreakdown.fear}%</div>
                <div class="heatmap-cell heatmap-anger">ЁЯШб ${analyticsData.emotionBreakdown.anger}%</div>
                <div class="heatmap-cell heatmap-confusion">ЁЯШХ ${analyticsData.emotionBreakdown.confusion}%</div>
                <div class="heatmap-cell heatmap-calm">ЁЯЩВ ${analyticsData.emotionBreakdown.calm}%</div>
                <div class="p-2 bg-gray-100 text-gray-800 rounded text-center text-sm dark:bg-gray-700 dark:text-gray-300">ЁЯШР ${100 - (analyticsData.emotionBreakdown.fear + analyticsData.emotionBreakdown.anger + analyticsData.emotionBreakdown.confusion + analyticsData.emotionBreakdown.calm)}%</div>
            `;

            // Update bulletin
            updateBulletinContent(currentLanguage);

            // Update analytics and logs
            updateAnalytics();
            updateActivityLogs();

            showToast(`Analysis complete! Verdict: ${data.status || 'FALSE'} (${conf}% confidence)`);
        })
        .catch(err => {
            // Backend unreachable тАФ fall back to local simulation
            console.warn('Backend analysis failed:', err);
            showToast('Backend unavailable тАФ running local simulation.');

            // reuse original simulation flow (quick fallback)
            setTimeout(() => {
                analyticsData.totalClaims++;
                analyticsData.accuracyRate = Math.min(100, Math.floor((analyticsData.accuracyRate * (analyticsData.totalClaims - 1) + 87) / analyticsData.totalClaims));
                analyticsData.bulletinsCreated++;
                analyticsData.peopleReached += Math.floor(Math.random() * 1000) + 100;

                analyticsData.recentClaims.unshift({
                    text: claimText.length > 50 ? claimText.substring(0, 50) + '...' : claimText,
                    verdict: 'FALSE',
                    confidence: 87,
                    time: 'Just now'
                });

                if (analyticsData.recentClaims.length > 5) analyticsData.recentClaims.pop();

                analyticsData.emotionBreakdown = {
                    fear: Math.floor(Math.random() * 40) + 20,
                    anger: Math.floor(Math.random() * 30) + 10,
                    confusion: Math.floor(Math.random() * 25) + 5,
                    calm: Math.floor(Math.random() * 20) + 5
                };

                const total = Object.values(analyticsData.emotionBreakdown).reduce((a, b) => a + b, 0);
                for (const emotion in analyticsData.emotionBreakdown) {
                    analyticsData.emotionBreakdown[emotion] = Math.round((analyticsData.emotionBreakdown[emotion] / total) * 100);
                }

                activityLogs.unshift({
                    title: 'Claim Analyzed',
                    description: `Analyzed claim: "${claimText}" - Verdict: FALSE with 87% confidence`,
                    time: 'Just now'
                });

                currentClaim.textContent = `"${claimText}"`;
                verdictSection.style.display = 'flex';
                evidenceSection.style.display = 'block';
                emotionSection.style.display = 'block';

                evidenceCards.innerHTML = `
                    <div class="evidence-card">
                        <div class="w-12 h-12 bg-blue-500 rounded-xl flex items-center justify-center text-white mr-4">
                            <i class="fas fa-satellite"></i>
                        </div>
                        <div>
                            <div class="font-medium text-sm dark:text-white">IMD</div>
                            <div class="text-blue-600 text-xs dark:text-blue-400">View official statement</div>
                        </div>
                    </div>
                `;

                emotionGrid.innerHTML = `
                    <div class="heatmap-cell heatmap-fear">ЁЯШи ${analyticsData.emotionBreakdown.fear}%</div>
                    <div class="heatmap-cell heatmap-anger">ЁЯШб ${analyticsData.emotionBreakdown.anger}%</div>
                    <div class="heatmap-cell heatmap-confusion">ЁЯШХ ${analyticsData.emotionBreakdown.confusion}%</div>
                    <div class="heatmap-cell heatmap-calm">ЁЯЩВ ${analyticsData.emotionBreakdown.calm}%</div>
                    <div class="p-2 bg-gray-100 text-gray-800 rounded text-center text-sm dark:bg-gray-700 dark:text-gray-300">ЁЯШР ${100 - (analyticsData.emotionBreakdown.fear + analyticsData.emotionBreakdown.anger + analyticsData.emotionBreakdown.confusion + analyticsData.emotionBreakdown.calm)}%</div>
                `;

                updateBulletinContent(currentLanguage);
                updateAnalytics();
                updateActivityLogs();

                showToast('Analysis complete! Verdict: FALSE (87% confidence)');
            }, 1200);
        });
    });
    
    // Search Functionality
    searchInput.addEventListener('keyup', (e) => {
        if (e.key === 'Enter') {
            const query = searchInput.value.trim();
            if (query) {
                showToast(`Searching for: ${query}`);
                // In a real app, this would trigger an API call
            }
        }
    });
    
    // Profile Toggle
    profileToggle.addEventListener('click', () => {
        profileModal.classList.toggle('active');
        profileArrow.style.transform = profileModal.classList.contains('active') ? 'rotate(180deg)' : 'rotate(0)';
    });
    
    mobileProfileToggle.addEventListener('click', () => {
        profileModal.classList.toggle('active');
    });
    
    // Notification Toggle
    notificationBtn.addEventListener('click', () => {
        notificationPanel.classList.toggle('active');
    });
    
    // Close modals when clicking outside
    [profileModal, editProfileModal, signupModal].forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.classList.remove('active');
                if (modal === profileModal) {
                    profileArrow.style.transform = 'rotate(0)';
                }
            }
        });
    });
    
    // Close notification panel when clicking outside
    document.addEventListener('click', (e) => {
        if (!notificationBtn.contains(e.target) && !notificationPanel.contains(e.target)) {
            notificationPanel.classList.remove('active');
        }
    });
    
    // Edit Profile
    editProfileBtn.addEventListener('click', () => {
        profileModal.classList.remove('active');
        setTimeout(() => {
            editProfileModal.classList.add('active');
        }, 300);
    });
    
    // Save Profile
    saveProfileBtn.addEventListener('click', () => {
        currentUser.name = editProfileName.value;
        currentUser.email = editProfileEmail.value;
        currentUser.initials = editProfileInitials.value;
        
        updateUserProfile();
        
        editProfileModal.classList.remove('active');
        setTimeout(() => {
            profileModal.classList.add('active');
        }, 300);
        
        showToast('Profile updated successfully!');
    });
    
    // Cancel Edit Profile
    cancelEditProfile.addEventListener('click', () => {
        editProfileModal.classList.remove('active');
        setTimeout(() => {
            profileModal.classList.add('active');
        }, 300);
    });
    
    // Bulletin actions
    copyBulletin.addEventListener('click', () => {
        navigator.clipboard.writeText(bulletinContent.textContent);
        showToast('Bulletin copied to clipboard!');
    });
    
    downloadBulletin.addEventListener('click', () => {
        showToast('Bulletin downloaded successfully!');
    });
    
    shareBulletin.addEventListener('click', () => {
        showToast('Bulletin shared to connected platforms!');
    });
    
    // Bulletin language tabs
    bulletinTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            bulletinTabs.forEach(t => {
                t.classList.remove('active', 'bg-blue-600', 'text-white');
                t.classList.add('bg-gray-100', 'text-gray-800', 'dark:bg-gray-700', 'dark:text-gray-300');
            });
            
            tab.classList.add('active', 'bg-blue-600', 'text-white');
            tab.classList.remove('bg-gray-100', 'text-gray-800', 'dark:bg-gray-700', 'dark:text-gray-300');
            
            const lang = tab.getAttribute('data-lang');
            updateBulletinContent(lang);
            showToast(`Switched to ${tab.textContent} bulletin`);
        });
    });
    
    // Language selection
    languageRadios.forEach(radio => {
        radio.addEventListener('change', () => {
            if (radio.checked) {
                applyLanguage(radio.value);
                showToast(`Language changed to ${radio.nextElementSibling.textContent}`);
            }
        });
    });
    
    // Settings actions
    exportData.addEventListener('click', () => {
        // In a real app, this would trigger a data export
        showToast('Data export started. You will receive an email shortly.');
    });
    
    clearCache.addEventListener('click', () => {
        showToast('Cache cleared successfully!');
    });
    
    resetSettings.addEventListener('click', () => {
        if (confirm('Are you sure you want to reset all settings? This action cannot be undone.')) {
            showToast('All settings have been reset to defaults.');
            
            // Reset checkboxes
            emailNotifications.checked = true;
            soundAlerts.checked = true;
            langEnglish.checked = true;
            
            // Reset language
            applyLanguage('en');
        }
    });
    
    // Filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.remove('active', 'bg-blue-100', 'text-blue-800', 'dark:bg-blue-900', 'dark:text-blue-200');
                b.classList.add('bg-gray-100', 'text-gray-800', 'dark:bg-gray-700', 'dark:text-gray-300');
            });
            
            btn.classList.add('active', 'bg-blue-100', 'text-blue-800', 'dark:bg-blue-900', 'dark:text-blue-200');
            btn.classList.remove('bg-gray-100', 'text-gray-800', 'dark:bg-gray-700', 'dark:text-gray-300');
            
            const platform = btn.textContent;
            showToast(`Filtering by: ${platform}`);
        });
    });
}

// New handler functions
function handleSignup() {
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    
    // Basic validation
    if (!name || !email || !password || !confirmPassword) {
        showToast('Please fill in all fields.');
        return;
    }
    
    if (password !== confirmPassword) {
        showToast('Passwords do not match.');
        return;
    }
    
    if (password.length < 6) {
        showToast('Password must be at least 6 characters long.');
        return;
    }
    
    // Create user account
    const names = name.split(' ');
    const firstName = names[0] ? names[0].charAt(0).toUpperCase() + names[0].slice(1) : 'User';
    const lastName = names[1] ? names[1].charAt(0).toUpperCase() + names[1].slice(1) : '';
    
    currentUser = {
        name: `${firstName} ${lastName}`.trim(),
        email: email,
        role: "Verified Analyst",
        initials: (firstName.charAt(0) + (lastName ? lastName.charAt(0) : '')).toUpperCase(),
        joinDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
    };
    
    updateUserProfile();
    
    // Close signup modal and show main app
    document.getElementById('signupModal').classList.remove('active');
    loginPage.style.display = 'none';
    mainApp.style.display = 'flex';
    
    // Clear signup form
    document.getElementById('signupName').value = '';
    document.getElementById('signupEmail').value = '';
    document.getElementById('signupPassword').value = '';
    document.getElementById('signupConfirmPassword').value = '';
    
    showToast('Account created successfully! Welcome to EchoGuard AI.');
}

function handleLogin() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    if (email && password) {
        // For demo purposes, create a user based on email
        const nameFromEmail = email.split('@')[0];
        const names = nameFromEmail.split('.');
        const firstName = names[0] ? names[0].charAt(0).toUpperCase() + names[0].slice(1) : 'User';
        const lastName = names[1] ? names[1].charAt(0).toUpperCase() + names[1].slice(1) : '';
        
        currentUser.name = `${firstName} ${lastName}`.trim();
        currentUser.email = email;
        currentUser.initials = (firstName.charAt(0) + (lastName ? lastName.charAt(0) : '')).toUpperCase();
        currentUser.joinDate = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
        
        updateUserProfile();
        
        // Transition to main app
        loginPage.style.display = 'none';
        mainApp.style.display = 'flex';
        
        showToast('Login successful! Welcome to EchoGuard AI.');
    } else {
        showToast('Please enter both email and password.');
    }
}

// function handleGoogleSignin() {
//     // Simulate Google OAuth process
//     showToast('Redirecting to Google sign-in...');
    
//     // Simulate successful Google sign-in after a delay
//     setTimeout(() => {
//         const randomNames = ['Alex Johnson', 'Sam Smith', 'Taylor Brown', 'Jordan Miller'];
//         const randomName = randomNames[Math.floor(Math.random() * randomNames.length)];
//         const names = randomName.split(' ');
        
//         currentUser = {
//             name: randomName,
//             email: `${names[0].toLowerCase()}.${names[1].toLowerCase()}@gmail.com`,
//             role: "Verified Analyst",
//             initials: (names[0].charAt(0) + names[1].charAt(0)).toUpperCase(),
//             joinDate: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })
//         };
        
//         updateUserProfile();
        
//         loginPage.style.display = 'none';
//         mainApp.style.display = 'flex';
        
//         showToast('Google sign-in successful! Welcome to EchoGuard AI.');
//     }, 1500);
// }
// Toast Notification Function
function showToast(message) {
    toastMessage.textContent = message;
    toast.classList.add('show');
    
    setTimeout(() => {
        toast.classList.remove('show');
    }, 3000);
}

// Initialize with dark mode if preferred
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
    themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    darkModeToggle.checked = true;
}

// Initialize the app when the page loads
window.addEventListener('DOMContentLoaded', initApp);